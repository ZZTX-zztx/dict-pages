<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云字典追加写入</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        .input-box { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; color: #333; }
        input { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        button { width: 100%; padding: 1rem; background: #4299e1; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; margin-bottom: 1rem; }
        button:hover { background: #3182ce; }
        .result { padding: 1rem; background: #f8f9fa; border-radius: 6px; border: 1px solid #ddd; white-space: pre-wrap; font-size: 0.9rem; }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin-bottom: 2rem;">云字典储存</h1>

    <!-- Key输入框 -->
    <div class="input-box">
        <label for="keyInput">[请输入key]</label>
        <input type="text" id="keyInput" placeholder="例如：手机号、姓名、邮箱">
    </div>

    <!-- Value输入框 -->
    <div class="input-box">
        <label for="valueInput">[请输入value]</label>
        <input type="text" id="valueInput" placeholder="例如：13800138000、张三、test@example.com">
    </div>

    <!-- 写入按钮 -->
    <button id="writeBtn">(写入)</button>

    <!-- 结果展示 -->
    <div class="input-box">
        <label>操作结果：</label>
        <div id="result" class="result">请输入Key和Value，点击写入按钮...</div>
    </div>

    <script>
        // 配置Worker域名（替换为你的实际域名）
        const WORKER_URL = "https://dict-pages.3809026566.workers.dev";
        
        // DOM元素
        const keyInput = document.getElementById('keyInput');
        const valueInput = document.getElementById('valueInput');
        const writeBtn = document.getElementById('writeBtn');
        const resultBox = document.getElementById('result');

        // 写入按钮点击事件
        writeBtn.addEventListener('click', async () => {
            // 获取输入值
            const key = keyInput.value.trim();
            const value = valueInput.value.trim();
            
            // 校验输入
            if (!key || !value) {
                showResult("错误：Key和Value都不能为空！", true);
                return;
            }

            try {
                // 显示加载状态
                showResult("正在写入云字典...");
                
                // 调用Worker追加接口
                const response = await fetch(`${WORKER_URL}/append`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ key, value })
                });

                const resData = await response.json();
                
                // 显示结果
                if (resData.code === 0) {
                    // 成功：展示提示 + 最新字典
                    let dictStr = JSON.stringify(resData.dict, null, 2);
                    showResult(`${resData.msg}\n\n当前云字典：\n${dictStr}`, false);
                    // 清空输入框
                    keyInput.value = '';
                    valueInput.value = '';
                } else {
                    showResult(resData.msg, true);
                }
            } catch (e) {
                showResult(`网络错误：${e.message}`, true);
            }
        });

        // 结果展示工具函数
        function showResult(text, isError = false) {
            resultBox.textContent = text;
            resultBox.className = `result ${isError ? 'error' : 'success'}`;
        }
    </script>
</body>
</html>
